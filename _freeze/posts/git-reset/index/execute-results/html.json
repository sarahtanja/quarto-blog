{
  "hash": "276ad768954443326640afc075869c1c",
  "result": {
    "markdown": "---\ntitle: \"Git Reset\"\nsubtitle: \"For all the times I accidentally commit a file that is too big\"\nauthor: \"Sarah Tanja\"\ndate: '11/05/2023'\ncategories: [code]\ndraft: false\ntoc: true\ntoc-title: Contents <i class=\"bi bi-bookmark-heart\"></i>\ntoc-depth: 5\ntoc-location: left\nreference-location: margin\ncitation-location: margin\neditor_options: \n  markdown: \n    wrap: 72\n---\n\n\n## Setup git hooks to automatically gitignore large files\n\nIn this assignment we're dealing with large files that will end up in\nthe ../data and ../output directories. To prevent those large files from\nclogging up our ability to 'git push', we can use built-in hooks to\nautomatically ignore files larger than 100 MB (no matter the directory\nor file name!). Here are the steps to follow:\n\n-   Create a new text file in the `.git/hooks/` directory of your\n    repository called `pre-commit`\n\n    > *Select the `More` tab with the gear icon under the RStudio Files\n    > navigator bar and select 'show hidden files' to see the .git\n    > folder*.\n\n-   Add the following text to the `.git/hooks/pre-commit` file:\n\n```         \n#!/bin/sh\n\n# Maximum file size (in bytes)\nmax_file_size=104857600\n\n# Find all files larger than max_file_size and add them to the .gitignore file\nfind . -type f -size +$max_file_size -exec echo \"{}\" >> .gitignore \\;\n```\n\n> This code sets the max_file_size variable to 100 MB and then uses the\n> find command to locate all files in the repository that are larger\n> than the specified max_file_size. The exec option of the find command\n> appends the name of each file that matches the criteria to the\n> .gitignore file.\n\nor\n\n#!/bin/bash\n\necho \"automatically ignoring large files\" find . -size 5M \\| sed\n's\\|\\^./\\|\\|g' \\>\\> .gitignore cat .gitignore \\| sort \\| uniq \\>\n.gitignore\n\ngit diff --exit-code .gitignore exit_status=\\$? if \\[ \\$exit_status -eq\n1 \\] then set +e for i in `cat .gitignore` do set +e git rm --cached \\$i\ndone\n\n```         \ngit add .gitignore\ngit commit .gitignore --no-verify -m\"ignoring large files\"\n\necho \"ignored new large files\"\n```\n\n> It is pretty brute force and the downside is that in case there were\n> new large files added by the git hook, the origin commit fails because\n> the state (hash) changed. So you need to execute another commit to\n> actually commit what you have staged. Consider this as a feature\n> telling you that new large files were detected ;-)\n\nSave the pre-commit file and make it executable by running the following\ncommand in Terminal from your base git directory:\n\n```         \nchmod +x .git/hooks/pre-commit\n```\n\nWith these changes, whenever you run a git commit command, Git will\nfirst execute the pre-commit hook, which will automatically add any\nfiles larger than 100 MB to the .gitignore file. This will prevent Git\nfrom tracking these files in the repository going forward.\n\n## Manually execute code to find and add files \\>1G to .gitignore before committing\n\nUse the following code as a bash terminal command to find and add files\n\\>1G from repo to .gitignore\n`find . -size +1G | sed 's|^./||g' | cat >> .gitignore` from\n[THIS](https://github.com/sr320/course-fish546-2015/issues/43) Robert's\nLab Course Issue\n\n## Using **`git revert`**:\n\n```         \n-   Open your terminal or command prompt.\n\n-   Navigate to the repository directory using the **`cd`** command.\n\n-   Execute the following command to revert the most recent commit:\n\n    `git revert HEAD`\n\n-   Git will create a new commit that undoes the changes introduced by the previous commit. A text editor will open for you to provide a commit message. Save and close the editor to complete the revert process.\n```\n\n## Using **`git reset`**\n\n```         \n-   Open your terminal or command prompt.\n\n-   Navigate to the repository directory using the **`cd`** command.\n\n-   Execute the following command to reset the repository to the commit before the most recent one:\n\n    `git reset HEAD~1`\n\n    This command moves the branch pointer to the commit before the most recent one, effectively undoing the last commit.\n\n-   Note that the changes introduced in the undone commit will still be present in your working directory. You can then modify or discard them as needed.\n```\n\nPlease exercise caution when using these commands, as they modify the\nGit history. If you have already pushed the commit you want to undo to a\nremote repository, it's generally not recommended to modify the history,\nas it can cause conflicts for other team members. In that case, it may\nbe better to consider reverting the changes in a new commit and pushing\nthat instead.\n\n## Last Resort... Burn it down\n\n> In the event that you accidentally committed a big file (\\>100MB), you\n> can reset to the last successful git master branch push\n\n::: callout-warning\n⚠️**warning this will overwrite any changes you made after your last\nsuccessful push**⚠️\n:::\n\n> If you still want to continue, you can un-comment the code and follow\n> this instruction:\n>\n> First, update all `origin/<branch>` refs to latest:\n>\n> ::: {.cell}\n> \n> ```{.bash .cell-code}\n> #git fetch --all\n> ```\n> :::\n>\n> Backup your current branch (e.g. `master`):\n>\n> ::: {.cell}\n> \n> ```{.bash .cell-code}\n> #git branch backup-branch\n> ```\n> :::\n>\n> Jump to the latest commit on `origin/master` :\n>\n> ::: {.cell}\n> \n> ```{.bash .cell-code}\n> #git reset --hard origin/main\n> ```\n> :::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}