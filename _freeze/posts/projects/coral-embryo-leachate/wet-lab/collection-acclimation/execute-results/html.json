{
  "hash": "3967ac239af6ff8d9297b28f1375c795",
  "result": {
    "markdown": "---\ntitle: \"Coral collections & tank acclimation protocol\"\nsubtitle: \"For spawning of Montipora capitata rice corals\"\nauthor: \"Sarah Tanja\"\ndate: 07/09/2024\ndate-format: long\ndate-modified: today\ncategories: [protocols]\n---\n\n\n# Goals\n\nDescribe the *Montipora capitata* coral colony collections under State of Hawai\\`i SAP2024-35 and tank acclimation prior to spawn night research activities in June & July of 2024.\n\n# Install & load packages\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Install packages\nif (!require(\"ggmap\", character.only = TRUE)){ install.packages(\"ggmap\")}\n\nif (!require(\"ggplot2\", character.only = TRUE)){ install.packages(\"ggplot2\")}\n\nif (!require(\"cowplot\", character.only = TRUE)){ install.packages(\"cowplot\")}\n\nif (!require(\"ggplotify\", character.only = TRUE)){ install.packages(\"ggplotify\")}\n\n\n## Load packages\nlibrary(ggplotify)\nlibrary(tidyverse)\nlibrary(leaflet)\nlibrary(ggmap)\nlibrary(ggplot2)\nlibrary(cowplot)\n```\n:::\n\n\n# Coral collection location\n\n![Lagoon snorkel entrance to fringing reef surrounding HIMB](Lagoon%20surrounding%20HIMB%2021.431215°N,%20-157.787347°W.png)\n\n![](KB-patchreefs-1.jpg)\n\n![](KB-patchreef-latlon.jpg)\n\n# Leaflet interactive map\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncoral_collection <- data.frame(\n  site = 'HIMB',\n  reef = 1,\n  lat = 21.431619,\n  lon = -157.787127,\n  collection_date = as.Date('06/30/2024', format = '%m/%d/%Y'),\n  colony_count = 20,\n  colony_size_cm = 30,\n  permit = 'SAP2024-35') \n\n\n# Prepare the text for the tooltip:\nmytext <- paste(\n   \"Patch Reef: \", coral_collection$reef, \"<br/>\", \n   \"Collection Date: \", coral_collection$collection_date) %>%\n  lapply(htmltools::HTML)\n\n# Generate Map\nKB <- leaflet(coral_collection) %>% \n  addTiles()  %>% \n  setView( lng = -157.787347, lat = 21.431229, zoom = 18 ) %>% \n  addProviderTiles(\"Esri.WorldImagery\") %>% \n  addCircleMarkers(~lon, ~lat, \n    fillColor = \"orange\", fillOpacity = 0.7, color=\"white\", radius=8, stroke=FALSE,\n    label = mytext,\n    labelOptions = labelOptions( style = list(\"font-weight\" = \"normal\", padding = \"3px 8px\"), textsize = \"13px\", direction = \"auto\")\n  )%>%\n  # Add a visible range (e.g., 100 meters)\n  addCircles(~lon, ~lat,\n    radius = 60,  # in meters\n    color = \"blue\", fill = FALSE, weight = 2\n  )\n\n# Display map\nKB\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"leaflet html-widget html-fill-item\" id=\"htmlwidget-d4019adb4c55d1f5ff74\" style=\"width:100%;height:464px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-d4019adb4c55d1f5ff74\">{\"x\":{\"options\":{\"crs\":{\"crsClass\":\"L.CRS.EPSG3857\",\"code\":null,\"proj4def\":null,\"projectedBounds\":null,\"options\":{}}},\"calls\":[{\"method\":\"addTiles\",\"args\":[\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\",null,null,{\"minZoom\":0,\"maxZoom\":18,\"tileSize\":256,\"subdomains\":\"abc\",\"errorTileUrl\":\"\",\"tms\":false,\"noWrap\":false,\"zoomOffset\":0,\"zoomReverse\":false,\"opacity\":1,\"zIndex\":1,\"detectRetina\":false,\"attribution\":\"&copy; <a href=\\\"https://openstreetmap.org/copyright/\\\">OpenStreetMap<\\/a>,  <a href=\\\"https://opendatacommons.org/licenses/odbl/\\\">ODbL<\\/a>\"}]},{\"method\":\"addProviderTiles\",\"args\":[\"Esri.WorldImagery\",null,null,{\"errorTileUrl\":\"\",\"noWrap\":false,\"detectRetina\":false}]},{\"method\":\"addCircleMarkers\",\"args\":[21.431619,-157.787127,8,null,null,{\"interactive\":true,\"className\":\"\",\"stroke\":false,\"color\":\"white\",\"weight\":5,\"opacity\":0.5,\"fill\":true,\"fillColor\":\"orange\",\"fillOpacity\":0.7},null,null,null,null,[\"Patch Reef:  1 <br/> Collection Date:  2024-06-30\"],{\"interactive\":false,\"permanent\":false,\"direction\":\"auto\",\"opacity\":1,\"offset\":[0,0],\"textsize\":\"13px\",\"textOnly\":false,\"style\":{\"font-weight\":\"normal\",\"padding\":\"3px 8px\"},\"className\":\"\",\"sticky\":true},null]},{\"method\":\"addCircles\",\"args\":[21.431619,-157.787127,60,null,null,{\"interactive\":true,\"className\":\"\",\"stroke\":true,\"color\":\"blue\",\"weight\":2,\"opacity\":0.5,\"fill\":false,\"fillColor\":\"blue\",\"fillOpacity\":0.2},null,null,null,{\"interactive\":false,\"permanent\":false,\"direction\":\"auto\",\"opacity\":1,\"offset\":[0,0],\"textsize\":\"10px\",\"textOnly\":false,\"className\":\"\",\"sticky\":true},null,null]}],\"setView\":[[21.431229,-157.787347],18,[]],\"limits\":{\"lat\":[21.431619,21.431619],\"lng\":[-157.787127,-157.787127]}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\n# Google static ggmap with cowplot\n\nRegister your API key with `register_google(key = \"your api key here\")`\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Define coordinates\nlocation <- c(lon = -157.78, lat = 21.43)\n\n# Get map\nmain_basemap <- get_map(location = location, zoom = 16, maptype = \"satellite\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nℹ <https://maps.googleapis.com/maps/api/staticmap?center=21.43,-157.78&zoom=16&size=640x640&scale=2&maptype=satellite&language=en-EN&key=xxx-_B4kLVVnbt4gpWJqCcY>\n```\n:::\n:::\n\n\n## Google main map\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Plot\nmain_map <- ggmap(main_basemap) +\n  geom_point(\n    data = coral_collection,\n    aes(x = lon, y = lat),\n    color = \"orange\",\n    size = 4\n  ) +\n  theme_minimal()\n\nmain_map\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 1 row containing missing values or values outside the scale range\n(`geom_point()`).\n```\n:::\n\n::: {.cell-output-display}\n![](collection-acclimation_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n## Stadia main map\n\nRegister API key\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbbox <- c(left = -158, bottom = 21.2, right = -157.4, top = 21.8)\n\nget_stadiamap(\n  bbox,\n  zoom = 8,\n  maptype = \"alidade_smooth\" \n) %>% ggmap()\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nℹ © Stadia Maps © Stamen Design © OpenMapTiles © OpenStreetMap contributors.\n```\n:::\n\n::: {.cell-output-display}\n![](collection-acclimation_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Define coordinates\nlocation <- c(lon = -157.787347, lat = 21.431215)\n\n# Get map\nmain_basemap <- get_map(location = location, zoom = 17, maptype = \"satellite\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nℹ <https://maps.googleapis.com/maps/api/staticmap?center=21.431215,-157.787347&zoom=17&size=640x640&scale=2&maptype=satellite&language=en-EN&key=xxx-_B4kLVVnbt4gpWJqCcY>\n```\n:::\n\n```{.r .cell-code}\ninset_basemap <- get_stadiamap(\n  bbox = c(left = -158, bottom = 21.2, right = -157.4, top = 21.8),\n  zoom = 8,\n  filetype = \"stamen_watercolor\" \n)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nℹ © Stadia Maps © Stamen Design © OpenMapTiles © OpenStreetMap contributors.\n```\n:::\n\n```{.r .cell-code}\n# 1. Bounding box from main map\nmain_bbox <- attr(main_basemap, \"bb\")\n\n# 2. Inset map with bounding box from main map\ninset_map <- ggmap(inset_basemap) +\n  annotate(\"rect\", \n           xmin = main_bbox$ll.lon, xmax = main_bbox$ur.lon,\n           ymin = main_bbox$ll.lat, ymax = main_bbox$ur.lat,\n           color = \"yellow\", fill = NA, linewidth = 1) +\n  theme_void()\n\n# 3. Convert both to standard ggplot objects\nmain_map_plot <- as.ggplot(main_map)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 1 row containing missing values or values outside the scale range\n(`geom_point()`).\n```\n:::\n\n```{.r .cell-code}\ninset_map_plot <- as.ggplot(inset_map)\n\n# 4. Compose using cowplot\nfinal_plot <- ggdraw() +\n  draw_plot(main_map_plot) +\n  draw_plot(inset_map_plot, x = 0.65, y = 0.65, width = 0.3, height = 0.3)\n\nprint(final_plot)\n```\n\n::: {.cell-output-display}\n![](collection-acclimation_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n# Tank acclimation\n\n![HIMB blue tank dimensions](PXL_20220612_035159238~2.jpg)\n\nIn inches the tank dimensions are 48in W x 55in L x 18in D. The water height was variable, and determined by the level of the stand-pipe. During acclimation 30cm diameter corals were kept in water \\~15in deep. Total volume of water that corals were acclimated in was therefore:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nincube <- 48*15*55\nprint(paste(incube,'inches cubed'))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"39600 inches cubed\"\n```\n:::\n:::\n\n\n1in^3^ (1 cubic inch) is equal to 0.0043290043 US gallons.\n\nThe volume of water in gallons is therefore:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngal <- incube*0.0043290043\nprint(paste(gal, 'gallons'))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"171.42857028 gallons\"\n```\n:::\n:::\n\n\nFinally, 1US gallon = 3.78541 liters\n\n\n::: {.cell}\n\n```{.r .cell-code}\nL <- gal*3.78541\nprint(paste(L, 'liters'))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"648.927424223615 liters\"\n```\n:::\n:::\n\n\nWe used [12qt(11.4L) cambro chambers](https://www.cambro.com/Products/food-storage/square-food-storage-containers/camsquares-classic-food-storage-containers/camsquares-camwear/12SFSCW135) as the individual bins for spawning.\n",
    "supporting": [
      "collection-acclimation_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../../../site_libs/htmltools-fill-0.5.8.1/fill.css\" rel=\"stylesheet\" />\r\n<script src=\"../../../../site_libs/htmlwidgets-1.6.4/htmlwidgets.js\"></script>\r\n<script src=\"../../../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js\"></script>\r\n<link href=\"../../../../site_libs/leaflet-1.3.1/leaflet.css\" rel=\"stylesheet\" />\r\n<script src=\"../../../../site_libs/leaflet-1.3.1/leaflet.js\"></script>\r\n<link href=\"../../../../site_libs/leafletfix-1.0.0/leafletfix.css\" rel=\"stylesheet\" />\r\n<script src=\"../../../../site_libs/proj4-2.6.2/proj4.min.js\"></script>\r\n<script src=\"../../../../site_libs/Proj4Leaflet-1.0.1/proj4leaflet.js\"></script>\r\n<link href=\"../../../../site_libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css\" rel=\"stylesheet\" />\r\n<script src=\"../../../../site_libs/leaflet-binding-2.2.2/leaflet.js\"></script>\r\n<script src=\"../../../../site_libs/leaflet-providers-2.0.0/leaflet-providers_2.0.0.js\"></script>\r\n<script src=\"../../../../site_libs/leaflet-providers-plugin-2.2.2/leaflet-providers-plugin.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}