---
title: "Coral collections & tank acclimation protocol"
subtitle: "For spawning of Montipora capitata rice corals"
author: "Sarah Tanja"
date: 2024-07-09
date-format: long
date-modified: today
categories: [protocols, records]
---

# Background

Describe the *Montipora capitata* coral colony collections under State of Hawai\`i Special Activities Permit 2024-35 and tank acclimation prior to spawn night research activities in June & July 2024 at HIMB.

## Install & load packages

```{r eval=FALSE, message=FALSE, warning=FALSE}
## Install packages
if (!require("ggmap", character.only = TRUE)){ install.packages("ggmap")}
if (!require("ggplot2", character.only = TRUE)){ install.packages("ggplot2")}
if (!require("cowplot", character.only = TRUE)){ install.packages("cowplot")}
if (!require("ggplotify", character.only = TRUE)){ install.packages("ggplotify")}
```

```{r}
## Load packages
library(ggplotify)
library(tidyverse)
library(leaflet)
library(ggmap)
library(ggplot2)
library(cowplot)
```

# Coral collection location

![Lagoon snorkel entrance to fringing reef surrounding HIMB](Lagoon%20surrounding%20HIMB%2021.431215째N,%20-157.787347째W.png)

![](KB-patchreefs-1.jpg)

![](KB-patchreef-latlon.jpg)

# Leaflet interactive map

```{r}
coral_collection <- data.frame(
  site = 'HIMB',
  reef = 1,
  lat = 21.431619,
  lon = -157.787127,
  collection_date = as.Date('06/30/2024', format = '%m/%d/%Y'),
  colony_count = 20,
  colony_size_cm = 30,
  permit = 'SAP2024-35') 


# Prepare the text for the tooltip:
mytext <- paste(
   "Patch Reef: ", coral_collection$reef, "<br/>", 
   "Collection Date: ", coral_collection$collection_date) %>%
  lapply(htmltools::HTML)

# Generate Map
KB <- leaflet(coral_collection) %>% 
  addTiles()  %>% 
  setView( lng = -157.787347, lat = 21.431229, zoom = 18 ) %>% 
  addProviderTiles("Esri.WorldImagery") %>% 
  addCircleMarkers(~lon, ~lat, 
    fillColor = "orange", fillOpacity = 0.7, color="white", radius=8, stroke=FALSE,
    label = mytext,
    labelOptions = labelOptions( style = list("font-weight" = "normal", padding = "3px 8px"), textsize = "13px", direction = "auto")
  )%>%
  # Add a visible range (e.g., 100 meters)
  addCircles(~lon, ~lat,
    radius = 60,  # in meters
    color = "blue", fill = FALSE, weight = 2
  )

# Display map
KB
```

# Google static ggmap with cowplot

Register your API key with `register_google(key = "your api key here")`

```{r}
#| include: false
# Register your API key
register_google(key = "AIzaSyC6_foVMJfxD3w-_B4kLVVnbt4gpWJqCcY")
```

```{r}
# Define coordinates
location <- c(lon = -157.78, lat = 21.43)

# Get map
main_basemap <- get_map(location = location, zoom = 16, maptype = "satellite")
```

## Google main map

```{r}
# Plot
main_map <- ggmap(main_basemap) +
  geom_point(
    data = coral_collection,
    aes(x = lon, y = lat),
    color = "orange",
    size = 4
  ) +
  theme_minimal()

main_map
```

## Stadia main map

Register API key

```{r, include=FALSE}
register_stadiamaps(key = "5850d823-fdbc-449e-ac23-123836628ba8", write = TRUE)
```

```{r}
bbox <- c(left = -158, bottom = 21.2, right = -157.4, top = 21.8)

get_stadiamap(
  bbox,
  zoom = 8,
  maptype = "alidade_smooth" 
) %>% ggmap()


```

## Collection site map with Hawaiian Islands inset

This map shows the coral collection location (21.43째N, 157.78째W) near HIMB with an inset map displaying all the Hawaiian Islands.

```{r}
#| fig-width: 10
#| fig-height: 8
#| warning: false
#| message: false
#| fig-cap: "Coral collection site on O'ahu with inset map showing location within the Hawaiian Islands"

# Define collection location coordinates as specified
location <- c(lon = -157.78, lat = 21.43)

# Get main map (collection site)
main_basemap <- get_map(location = location, zoom = 17, maptype = "satellite")

# Create main map with collection point
main_map <- ggmap(main_basemap) +
  geom_point(
    aes(x = -157.78, y = 21.43),
    color = "orange",
    size = 5,
    shape = 21,
    fill = "orange",
    stroke = 2
  ) +
  labs(
    x = "Longitude",
    y = "Latitude"
  ) +
  theme_minimal() +
  theme(
    axis.title = element_text(size = 10),
    axis.text = element_text(size = 8)
  )

# Get inset map showing Hawaiian Islands
# Bounding box to capture main Hawaiian Islands (Kauai to Hawaii Island)
inset_basemap <- get_stadiamap(
  bbox = c(left = -160.5, bottom = 18.8, right = -154.7, top = 22.3),
  zoom = 7,
  maptype = "stamen_terrain"
)

# Get bounding box from main map for reference rectangle
main_bbox <- attr(main_basemap, "bb")

# Create inset map with Hawaiian Islands labels
inset_map <- ggmap(inset_basemap) +
  # Add rectangle showing main map location
  annotate("rect", 
           xmin = main_bbox$ll.lon, xmax = main_bbox$ur.lon,
           ymin = main_bbox$ll.lat, ymax = main_bbox$ur.lat,
           color = "red", fill = NA, linewidth = 1.5) +
  # Add collection point on inset
  geom_point(
    aes(x = -157.78, y = 21.43),
    color = "red",
    size = 3
  ) +
  # Add Hawaiian Islands labels
  annotate("text", x = -159.5, y = 22.0, label = "Kaua'i", 
           size = 3, fontface = "italic") +
  annotate("text", x = -157.0, y = 21.1, label = "O'ahu", 
           size = 3, fontface = "italic") +
  annotate("text", x = -156.9, y = 20.8, label = "Moloka'i", 
           size = 3, fontface = "italic") +
  annotate("text", x = -156.6, y = 20.5, label = "Lana'i", 
           size = 2.5, fontface = "italic") +
  annotate("text", x = -156.3, y = 20.8, label = "Maui", 
           size = 3, fontface = "italic") +
  annotate("text", x = -155.5, y = 19.6, label = "Hawai'i", 
           size = 3, fontface = "italic") +
  # Add overall label
  annotate("text", x = -157.5, y = 19.2, label = "Hawaiian Islands", 
           size = 4, fontface = "bold") +
  theme_void() +
  theme(
    panel.border = element_rect(colour = "black", fill = NA, linewidth = 1)
  )

# Compose using cowplot to create final map with inset
final_plot <- ggdraw() +
  draw_plot(main_map) +
  draw_plot(inset_map, x = 0.05, y = 0.65, width = 0.35, height = 0.35)

print(final_plot)
```

# Tank acclimation

![HIMB blue tank dimensions](PXL_20220612_035159238~2.jpg)

In inches the tank dimensions are 48in W x 55in L x 18in D. The water height was variable, and determined by the level of the stand-pipe. During acclimation 30cm diameter corals were kept in water \~15in deep. Total volume of water that corals were acclimated in was therefore:

```{r}
incube <- 48*15*55
print(paste(incube,'inches cubed'))
```

1in^3^ (1 cubic inch) is equal to 0.0043290043 US gallons.

The volume of water in gallons is therefore:

```{r}
gal <- incube*0.0043290043
print(paste(gal, 'gallons'))
```

Finally, 1US gallon = 3.78541 liters

```{r}
L <- gal*3.78541
print(paste(L, 'liters'))
```

We used [12qt(11.4L) cambro chambers](https://www.cambro.com/Products/food-storage/square-food-storage-containers/camsquares-classic-food-storage-containers/camsquares-camwear/12SFSCW135) as the individual bins for spawning.
